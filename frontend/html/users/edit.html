{% extends "layout.html" %}
{% load static %}

{% block title %}
    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è ‚Äî {{ block.super }}
{% endblock %}

{% block content %}
    <div class="content user-edit">
        <form action="." method="post" class="intro-form" enctype="multipart/form-data">
            {% csrf_token %}

            <div class="form-title">üòé<br>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è</div>

            {% if form.non_field_errors %}
                <div class="form-row form-row-center">
                    {% for error in form.non_field_errors %}
                        <span class="form-row-errors">{{ error }}</span>
                    {% endfor %}
                </div>
            {% endif %}

            <div class="block">
                <div class="form-row">
                    <label for="{{ form.full_name.id_for_label }}" class="form-label">
                        {{ form.full_name.label }}
                    </label>
                    {{ form.full_name }}
                    {% if form.full_name.errors %}<span class="form-row-errors">{{ form.full_name.errors }}</span>{% endif %}
                    <span class="form-row-help">–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —É–∫–∞–∑—ã–≤–∞—Ç—å –∏–º—è + —Ñ–∞–º–∏–ª–∏—é, –ª–∏–±–æ –ø—Å–µ–≤–¥–æ–Ω–∏–º, –µ—Å–ª–∏ –≤–∞—Å –ª—É—á—à–µ –∑–Ω–∞—é—Ç –ø–æ&nbsp;–Ω–µ–º—É.</span>
                </div>

                <div class="form-row">
                    <label for="{{ form.country.id_for_label }}" class="form-label">
                        {{ form.country.label }} –∏&nbsp;{{ form.city.label }}
                    </label>
                    {{ form.country }} {{ form.city }}
                    {% if form.country.errors %}<span class="form-row-errors">{{ form.country.errors }}</span>{% endif %}
                    {% if form.city.errors %}<span class="form-row-errors">{{ form.city.errors }}</span>{% endif %}
                    <span class="form-row-help">–í–¥—Ä—É–≥ –º—ã&nbsp;—Ä–µ—à–∏–º —Å–æ–±—Ä–∞—Ç—å—Å—è –Ω–∞&nbsp;–º–∏—Ç–∞–ø –∏–ª–∏ —Ç–∏–ø–∞ —Ç–æ–≥–æ.</span>
                </div>

                <div class="form-row">
                    <label for="{{ form.bio.id_for_label }}" class="form-label">
                        {{ form.bio.label }}
                    </label>
                    {{ form.bio }}
                    {% if form.bio.errors %}<span class="form-row-errors">{{ form.bio.errors }}</span>{% endif %}
                    <span class="form-row-help">–ú–æ–∂–Ω–æ <a href="https://www.markdownguide.org/basic-syntax/" target="_blank">Markdown</a></span>
                </div>

                <div class="form-row">
                    <label for="{{ form.avatar.id_for_label }}" class="form-label">
                        {{ form.avatar.label }}
                    </label>
                    {{ form.avatar }}
                    {% if form.avatar.errors %}<span class="form-row-errors">{{ form.avatar.errors }}</span>{% endif %}
                </div>

                <div class="form-row">
                    <label for="{{ form.company.id_for_label }}" class="form-label">
                        {{ form.company.label }}
                    </label>
                    {{ form.company }}
                    {% if form.company.errors %}<span class="form-row-errors">{{ form.company.errors }}</span>{% endif %}
                </div>

                <div class="form-row">
                    <label for="{{ form.position.id_for_label }}" class="form-label">
                        {{ form.position.label }}
                    </label>
                    {{ form.position }}
                    {% if form.position.errors %}<span class="form-row-errors">{{ form.position.errors }}</span>{% endif %}
                </div>
            </div>

            <div class="clearfix20"></div>

            <div class="block" id="digest-settings">
                <div class="block-header">üì´<br>–ö–∞–∫ —Ö–æ—Ç–∏—Ç–µ —Å–ª–µ–¥–∏—Ç—å –∑–∞&nbsp;–ø–æ—Å—Ç–∞–º–∏ –∏&nbsp;–∫–æ–º–º–µ–Ω—Ç–∞–º–∏?</div>

                {% if not form.instance.is_email_verified %}
                    <div class="block form-warning">‚ö†Ô∏è –í—ã&nbsp;–Ω–µ&nbsp;–ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª–∏ —Å–≤–æ–π –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã, —Ç–∞–∫ —á—Ç–æ –º—ã&nbsp;–ø–æ–∫–∞ –Ω–µ&nbsp;–±—É–¥–µ–º —Å–ª–∞—Ç—å –Ω–∞&nbsp;–Ω–µ–≥–æ —Ä–∞—Å—Å—ã–ª–∫–∏</div>
                {% endif %}

                <div class="clearfix20"></div>

                <div class="form-row">
                    <div class="user-edit-digest">
                        <div class="user-edit-digest">
                            <label for="{{ form.email_digest_type.1.id_for_label }}" class="user-edit-digest-label">
                                <i class="fas fa-envelope-open"></i>
                                <span class="user-edit-digest-name">–®–ª–∏—Ç–µ –º–Ω–µ –≤—Å—ë!<br><small style="display: inline-block; margin-top: 20px; line-height: 1.3em;">+ –≥–æ—Ä–æ—Å–∫–æ–ø –≤&nbsp;–ø–æ–¥–∞—Ä–æ–∫</small></span>
                                {{  form.email_digest_type.1.tag }}
                            </label>
                            <label for="{{ form.email_digest_type.2.id_for_label }}" class="user-edit-digest-label">
                                <i class="fas fa-calendar-week"></i>
                                <span class="user-edit-digest-name">–¢–æ–ª—å–∫–æ –∂—É—Ä–Ω–∞–ª —Ä–∞–∑ –≤&nbsp;–Ω–µ–¥–µ–ª—é</span>
                                {{  form.email_digest_type.2.tag }}
                            </label>
                            <label for="{{ form.email_digest_type.0.id_for_label }}" class="user-edit-digest-label">
                                <i class="fas fa-skull-crossbones"></i>
                                <span class="user-edit-digest-name">–ù–∏–∫–∞–∫ –Ω–µ&nbsp;—Ö–æ—á—É</span>
                                {{  form.email_digest_type.0.tag }}
                            </label>
                        </div>
                    </div>
                    {% if form.email_digest_type.errors %}<span class="form-row-errors">{{ form.email_digest_type.errors }}</span>{% endif %}
                </div>

                <div class="block-header">–î—Ä—É–≥–∏–µ —Å–ø–æ—Å–æ–±—ã –±—ã—Ç—å –≤&nbsp;–∫—É—Ä—Å–µ üëá</div>

                <div class="block-description" style="text-align: left;">
                    <a href="{{ settings.TELEGRAM_CLUB_CHANNEL_URL }}" target="_blank" style="font-weight: bold;">–¢–µ–ª–µ–≥—Ä–∞–º-–∫–∞–Ω–∞–ª –ö–ª—É–±–∞</a>&nbsp;&mdash; —Ç—É–¥–∞ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä—ã –æ—Ç–±–∏—Ä–∞—é—Ç –ª—É—á—à–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç. –û–Ω&nbsp;–∂–µ –≥–ª–∞–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –≤—Å–µ—Ö –∞–Ω–æ–Ω—Å–æ–≤.<br><br>
                    <a href="https://vas3k.ru/notes/club_chat/" target="_blank" style="font-weight: bold;">–°–µ–∫—Ä–µ—Ç–Ω—ã–µ –ß–∞—Ç—ã</a>&nbsp;&mdash; –Ω–∞—à–∞ —Å–µ—Ç—å —á–∞—Ç–æ–≤ –æ–±–æ –≤—Å—ë–º. –¢—É–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ø–∞–¥–∞—é—Ç —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ—Å—Ç—ã.<br><br>
                    <a href="{{ settings.TELEGRAM_ONLINE_CHANNEL_URL }}" target="_blank" style="font-weight: bold;">–û–Ω–ª–∞–π–Ω</a>&nbsp;&mdash; –ø—Ä—è–º–æ–π —ç—Ñ–∏—Ä. –¢–æ–ª—å–∫–æ –¥–ª—è —Å–∞–º—ã—Ö —Ö–∞—Ä–¥–∫–æ—Ä–Ω—ã—Ö.<br><br>

                    –ù–µ&nbsp;–∑–∞–±—É–¥—å—Ç–µ <strong>–ø–æ–¥–∫–ª—é—á–∏—Ç—å –Ω–∞—à–µ–≥–æ –±–æ—Ç–∞</strong>, —Ç–æ–≥–¥–∞ –æ–Ω&nbsp;–±—É–¥–µ—Ç –ø—Ä–∏–Ω–æ—Å–∏—Ç—å –≤–∞–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è, –∫–∞—Å–∞—é—â–∏–µ—Å—è –ª–∏—á–Ω–æ –≤–∞—Å.
                </div>
            </div>

            <div class="clearfix50"></div>

            <div class="block">
                <div class="block-header">ü§ñ<br>–¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç</div>

                <div class="clearfix20"></div>

                <div class="block-description">
                    <p>
                        <strong>–ë–æ—Ç&nbsp;&mdash; –≤–∞–∂–Ω–æ–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫&nbsp;–ö–ª—É–±—É.</strong>
                        –û–Ω&nbsp;–æ–ø–æ–≤–µ—â–∞–µ—Ç –æ&nbsp;–Ω–æ–≤—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö, —á–µ—Ä–µ–∑ –Ω–µ–≥–æ –º–æ–∂–Ω–æ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞&nbsp;–Ω–∏—Ö –∏&nbsp;–¥–∞–∂–µ –ø–∏—Å–∞—Ç—å –ø–æ—Å—Ç—ã, —Ñ–æ—Ä–≤–∞—Ä–¥—è –µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—è.
                    </p>

                    <p>
                        –ù–∞&nbsp;–Ω–µ–≥–æ –∑–∞–≤—è–∑–∞–Ω–æ –º–Ω–æ–≥–æ —Ñ–∏—á, –∏&nbsp;–º—ã&nbsp;–æ—á–µ–Ω—å —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –µ–≥–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å.
                    </p>

                    <p id="telegram-auth-data" style="font-weight: bold;">
                        {% if form.instance.telegram_id %}
                           –°–µ–π—á–∞—Å –ø—Ä–∏–≤—è–∑–∞–Ω –∞–∫–∫–∞—É–Ω—Ç: {{ form.instance.telegram_data.username }} ‚úÖ
                        {% endif %}
                    </p>

                    <p>
                        <script async src="https://telegram.org/js/telegram-widget.js?8" data-telegram-login="vas3k_club_bot" data-size="large" data-onauth="onTelegramAuth(user)" data-request-access="write"></script>
                        <script type="text/javascript">
                            function onTelegramAuth(user) {
                                fetch('{% url "link_telegram" %}?is_ajax=true', {
                                    method: 'POST',
                                    headers: {
                                        'Accept': 'application/json, text/plain, */*',
                                        'Content-Type': 'application/json'
                                    },
                                    credentials: "include",
                                    body: JSON.stringify(user)
                                })
                                .then((response) => {
                                    return response.json();
                                })
                                .then((data) => {
                                  if (data.status === "success") {
                                      document.getElementById("telegram-auth-data").innerHTML = "üòé –í—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –∫–∞–∫: " + data.telegram.username;
                                      document.getElementById("telegram-auth-button").style.display = "none";
                                  } else {
                                      document.getElementById("telegram-auth-data").innerHTML = "–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.";
                                  }
                                  document.getElementById("telegram-auth-data").style.display = "block";
                                });
                            }
                        </script>
                    </p>

                    <p style="font-size: 90%;">
                        ‚òùÔ∏è –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∏ —Å–≤–µ—Ä—Ö—É –Ω–µ&nbsp;–≤–∏–¥–Ω–æ, –∑–Ω–∞—á–∏—Ç —É&nbsp;–≤–∞—Å –†–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä –∏–ª–∏ AdBlock. –ü—Ä–∏–¥—ë—Ç—Å—è –∏—Ö&nbsp;–æ–±–º–∞–Ω—É—Ç—å.
                        –ó–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–∞—à–µ–≥–æ <a href="{{ settings.TELEGRAM_BOT_URL }}" target="_blank">–±–æ—Ç–∞</a> –∏&nbsp;—Å–∫–∞–∂–∏—Ç–µ –µ–º—É –≤–æ—Ç —ç—Ç–æ—Ç —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥: <strong>{{ form.instance.secret_hash }}</strong>
                    </p>
                </div>
            </div>

            <div class="clearfix50"></div>

            <button type="submit" class="button button-red">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        </form>
    </div>
{% endblock %}
